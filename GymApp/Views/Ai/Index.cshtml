@{
    ViewData["Title"] = "AI Antren√∂r";
}

<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="fw-bold">Google Gemini AI Antren√∂r</h1>
        <p class="text-muted">Ki≈üisel fitness programƒ±nƒ± olu≈ütur.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-5 mb-4">
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4">üèãÔ∏è Fiziksel Bilgiler</h5>
                    <form id="aiForm">
                        <div class="row g-3">
                            <div class="col-6">
                                <label class="form-label small text-muted">Cinsiyet</label>
                                <select class="form-select" id="Gender">
                                    <option>Kadƒ±n</option>
                                    <option>Erkek</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small text-muted">Ya≈ü</label>
                                <input type="number" class="form-control" id="Age" value="22">
                            </div>
                            <div class="col-6">
                                <label class="form-label small text-muted">Boy (cm)</label>
                                <input type="number" class="form-control" id="Height" value="170">
                            </div>
                            <div class="col-6">
                                <label class="form-label small text-muted">Kilo (kg)</label>
                                <input type="number" class="form-control" id="Weight" value="65">
                            </div>
                            <div class="col-12">
                                <label class="form-label small text-muted">Hedef</label>
                                <select class="form-select" id="Goal">
                                    <option>Kilo Vermek</option>
                                    <option>Kas Yapmak</option>
                                    <option>Fit Kalmak</option>
                                </select>
                            </div>
                        </div>

                        <button type="button" onclick="programOlustur()" class="btn btn-danger w-100 rounded-pill mt-4 fw-bold py-3">
                            AI PROGRAM OLU≈ûTUR
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card border-0 shadow-lg rounded-4 h-100 bg-light">
                <div class="card-body p-4" id="resultContainer">

                    <div id="loadingView" style="display:none; text-align:center; margin-top: 50px;">
                        <div class="spinner-border text-danger" role="status"></div>
                        <p class="mt-2">Program hazƒ±rlanƒ±yor...</p>
                    </div>

                    <div id="resultView" style="display:none;">

                        <div class="text-center mb-4 bg-white p-3 rounded shadow-sm">
                            <h6 class="fw-bold text-dark mb-2">üéØ Hedefindeki Sen (Temsili):</h6>
                            <img id="targetBodyImage" src="" class="img-fluid rounded" style="max-height: 250px;">
                        </div>

                        <div class="alert alert-primary">
                            <h5 id="bmiText" class="fw-bold">BMI: -</h5>
                            <p id="adviceText" class="mb-0">Tavsiye...</p>
                        </div>

                        <h6 class="fw-bold">üìã Sana √ñzel Program:</h6>
                        <div id="planContent" class="bg-white p-4 rounded shadow-sm"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function programOlustur() {
        $('#resultView').hide();
        $('#loadingView').fadeIn();

        var data = {
            Age: parseInt($('#Age').val()),
            Height: parseFloat($('#Height').val()),
            Weight: parseFloat($('#Weight').val()),
            Gender: $('#Gender').val(),
            Goal: $('#Goal').val()
        };

        $.ajax({
            type: "POST",
            url: "/Ai/GeneratePlan",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (response) {
                $('#loadingView').hide();
                $('#bmiText').text(response.bmiResult);
                $('#adviceText').text(response.advice);

                // 1. Resmi Yerle≈ütir
                $('#targetBodyImage').attr('src', response.targetImage);

                // 2. Yazƒ±yƒ± HTML Olarak Yerle≈ütir (S√ºsl√º g√∂r√ºn√ºr)
                if(response.workoutPlan && response.workoutPlan.length > 0) {
                     $('#planContent').html(response.workoutPlan[0]);
                }

                $('#resultView').fadeIn();
            },
            error: function (xhr) {
                $('#loadingView').hide();
                alert("Hata: " + (xhr.responseJSON ? xhr.responseJSON.Advice : "Bilinmeyen Hata"));
            }
        });
    }
</script>
