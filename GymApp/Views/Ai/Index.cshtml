@{
    ViewData["Title"] = "AI Antrenör";
}

<style>
    /* Google Gradient Başlık */
    .google-gradient-text {
        background: linear-gradient(45deg, #4285F4, #34A853, #FBBC05, #EA4335);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
    }

    /* Kart Gölgelendirmeleri */
    .custom-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        transition: transform 0.3s ease;
    }

        .custom-card:hover {
            transform: translateY(-5px);
        }

    /* Sonuç Listesi Tasarımı */
    .workout-item {
        background-color: #f8f9fa; /* Hafif gri arka plan */
        border-left: 5px solid #4285F4; /* Sol taraf mavi çizgi */
        margin-bottom: 10px;
        border-radius: 8px;
        padding: 15px;
        color: #2c3e50 !important; /* YAZI RENGİNİ SİYAH YAPAR (ÖNEMLİ) */
        font-weight: 500;
    }

    /* BMI Kutusu */
    .bmi-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
    }
</style>

<div class="container mt-5">
    <div class="text-center mb-5">
        <div class="d-inline-block p-3 rounded-circle bg-white shadow-sm mb-3">
            <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ff6292a690345.svg" width="60" alt="Gemini Logo">
        </div>
        <h1 class="display-4 fw-bold mb-2">Gemini <span class="google-gradient-text">AI Antrenör</span></h1>
        <p class="text-secondary fs-5">Sana özel, bilimsel ve kişisel antrenman programı.</p>
    </div>

    <div class="row justify-content-center g-4">
        <div class="col-lg-5">
            <div class="card custom-card h-100">
                <div class="card-header bg-white border-0 pt-4 px-4">
                    <h5 class="fw-bold text-dark"><i class="fa-solid fa-user-gear me-2 text-primary"></i>Profilini Oluştur</h5>
                </div>
                <div class="card-body p-4">
                    <form id="aiForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select border-0 bg-light" id="Gender">
                                        <option>Kadın</option>
                                        <option>Erkek</option>
                                    </select>
                                    <label for="Gender">Cinsiyet</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control border-0 bg-light" id="Age" value="22">
                                    <label for="Age">Yaş</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control border-0 bg-light" id="Height" value="170">
                                    <label for="Height">Boy (cm)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control border-0 bg-light" id="Weight" value="65">
                                    <label for="Weight">Kilo (kg)</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <select class="form-select border-0 bg-light" id="Goal">
                                        <option>Kilo Vermek ve Sıkılaşmak</option>
                                        <option>Kas Kütlesi Artırmak</option>
                                        <option>Genel Sağlık ve Kondisyon</option>
                                        <option>Karın Kası (Six-Pack) Yapmak</option>
                                    </select>
                                    <label for="Goal">Hedefin Nedir?</label>
                                </div>
                            </div>
                        </div>

                        <button type="button" onclick="programOlustur()" class="btn btn-dark w-100 rounded-pill mt-4 py-3 fw-bold shadow-lg text-uppercase" style="letter-spacing: 1px;">
                            <i class="fa-solid fa-wand-magic-sparkles me-2 text-warning"></i> Programı Hazırla
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            <div class="card custom-card h-100 bg-white">
                <div class="card-body p-5 d-flex flex-column align-items-center justify-content-center text-center" id="resultContainer">

                    <div id="startView">
                        <div class="mb-3 p-4 rounded-circle bg-light d-inline-block">
                            <i class="fa-solid fa-dumbbell fa-4x text-muted opacity-50"></i>
                        </div>
                        <h4 class="text-dark fw-bold">Henüz Program Yok</h4>
                        <p class="text-muted small">Sol taraftaki bilgileri doldurup butona bas,<br>Gemini senin için en iyi programı hazırlasın.</p>
                    </div>

                    <div id="loadingView" style="display:none;">
                        <div class="spinner-grow text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                        <h5 class="fw-bold text-dark animate__animated animate__pulse animate__infinite">Analiz Ediliyor...</h5>
                        <p class="text-muted small">Vücut kitle indeksin hesaplanıyor ve egzersizler planlanıyor.</p>
                    </div>

                    <div id="resultView" style="display:none; width: 100%; text-align: left;">

                        <div class="bmi-badge mb-4 text-center">
                            <h3 class="fw-bold mb-0" id="bmiText">BMI: Hesaplandı</h3>
                            <hr style="border-color: rgba(255,255,255,0.3);">
                            <p class="mb-0 fst-italic" id="adviceText">Tavsiye yükleniyor...</p>
                        </div>

                        <h6 class="fw-bold text-dark mb-3 ps-2 border-start border-4 border-warning">
                            &nbsp; GÜNLÜK RUTİNİN:
                        </h6>

                        <div id="planList" class="mt-3">
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function programOlustur() {
        // Ekran geçişleri
        $('#startView').fadeOut(200, function() {
            $('#resultView').hide();
            $('#loadingView').fadeIn(200);
        });

        var data = {
            Age: parseInt($('#Age').val()),
            Height: parseFloat($('#Height').val()),
            Weight: parseFloat($('#Weight').val()),
            Gender: $('#Gender').val(),
            Goal: $('#Goal').val()
        };

        $.ajax({
            type: "POST",
            url: "/Ai/GeneratePlan",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (response) {
                $('#loadingView').hide();

                // Verileri Yazdır
                $('#bmiText').text(response.bmiResult);
                $('#adviceText').text('"' + response.advice + '"');

                $('#planList').empty();

                // Gelen metni satırlara bölüp liste yapıyoruz
                // Eğer yapay zeka tek parça metin dönerse bunu satır satır böleriz
                if(response.workoutPlan && response.workoutPlan.length > 0) {

                    // Gelen veri bir dizi mi yoksa tek string mi?
                    var textToParse = Array.isArray(response.workoutPlan) ? response.workoutPlan[0] : response.workoutPlan;

                    // Satır satır bölüyoruz (nokta veya satır sonuna göre)
                    var lines = textToParse.split('\n');

                    lines.forEach(function(line) {
                        // Boş satırları atla
                        if(line.trim() !== "") {
                            // Yıldızları temizle (Markdown bold işaretlerini kaldırmak için)
                            var cleanLine = line.replace(/\*\*/g, '').replace(/\*/g, '').trim();

                            // Ekrana Şık Kutular Halinde Ekle
                            var listItem = `
                                <div class="workout-item shadow-sm">
                                    <i class="fa-solid fa-circle-check text-primary me-2"></i> ${cleanLine}
                                </div>
                            `;
                            $('#planList').append(listItem);
                        }
                    });
                }

                $('#resultView').fadeIn(400);
            },
            error: function () {
                $('#loadingView').hide();
                alert("Bir hata oluştu. Lütfen tekrar dene.");
                $('#startView').fadeIn();
            }
        });
    }
</script>