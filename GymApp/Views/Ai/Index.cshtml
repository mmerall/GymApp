@{
    ViewData["Title"] = "AI Antrenör";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center mb-5">
            <div class="d-inline-block p-3 rounded-circle bg-dark shadow mb-3">
                <i class="fa-solid fa-robot fa-4x text-danger"></i>
            </div>
            <h1 class="fw-bold">Yapay Zeka Antrenör</h1>
            <p class="text-muted">Fiziksel özelliklerini gir, algoritmamız saniyeler içinde sana özel programı çıkarsın.</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-5 mb-4">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-header bg-white border-0 p-4">
                    <h5 class="fw-bold mb-0"><i class="fa-solid fa-sliders me-2"></i> Bilgilerin</h5>
                </div>
                <div class="card-body p-4">
                    <form id="aiForm">
                        <div class="row g-3">
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Cinsiyet</label>
                                <select class="form-select" id="Gender">
                                    <option value="Kadın">Kadın</option>
                                    <option value="Erkek">Erkek</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Yaş</label>
                                <input type="number" class="form-control" id="Age" value="22">
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Boy (cm)</label>
                                <input type="number" class="form-control" id="Height" value="170">
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Kilo (kg)</label>
                                <input type="number" class="form-control" id="Weight" value="65">
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold small text-muted">Hedefin</label>
                                <select class="form-select" id="Goal">
                                    <option value="Kilo Ver">Kilo Vermek (Yağ Yakımı)</option>
                                    <option value="Kas Yap">Kas Yapmak (Hipertrofi)</option>
                                    <option value="Fit Kal">Fit Kalmak (Kondisyon)</option>
                                </select>
                            </div>
                        </div>

                        <button type="button" onclick="programOlustur()" class="btn btn-danger w-100 rounded-pill mt-4 fw-bold py-3 shadow">
                            <i class="fa-solid fa-wand-magic-sparkles me-2"></i> ANALİZ ET & OLUŞTUR
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-7 mb-4">
            <div class="card border-0 shadow-lg rounded-4 h-100" style="background: linear-gradient(135deg, #2b32b2 0%, #1488cc 100%); color: white;">
                <div class="card-body p-5 d-flex flex-column justify-content-center align-items-center text-center" id="resultArea">

                    <div id="startMessage">
                        <i class="fa-solid fa-chart-simple fa-5x mb-3 opacity-50"></i>
                        <h3>Sonuçlar Burada Görünecek</h3>
                        <p class="opacity-75">Sol taraftan bilgilerinizi girip butona basınız.</p>
                    </div>

                    <div id="loadingMessage" style="display:none;">
                        <div class="spinner-border text-light mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                        <h4>Veriler Analiz Ediliyor...</h4>
                        <p class="opacity-75">Vücut tipinize uygun egzersizler taranıyor.</p>
                    </div>

                    <div id="resultContent" style="display:none; text-align: left; width: 100%;">
                        <div class="bg-white text-dark rounded-4 p-4 shadow-sm mb-3">
                            <h5 class="fw-bold text-primary mb-2" id="bmiResult">BMI: -</h5>
                            <p id="adviceText" class="mb-0">Tavsiye...</p>
                        </div>

                        <h5 class="fw-bold mt-3 mb-3"><i class="fa-solid fa-list-check me-2"></i> Senin İçin Hazırlanan Program:</h5>
                        <ul class="list-group list-group-flush rounded-3 text-dark" id="workoutList">
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function programOlustur() {
        // 1. Yükleniyor ekranını aç
        $('#startMessage').hide();
        $('#resultContent').hide();
        $('#loadingMessage').fadeIn();

        // 2. Verileri Topla
        var data = {
            Gender: $('#Gender').val(),
            Age: parseInt($('#Age').val()),
            Height: parseFloat($('#Height').val()),
            Weight: parseFloat($('#Weight').val()),
            Goal: $('#Goal').val()
        };

        // 3. 1.5 Saniye Yapay Gecikme (Sanki AI düşünüyormuş gibi görünsün diye)
        setTimeout(function() {
            $.ajax({
                type: "POST",
                url: "/Ai/GeneratePlan",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data),
                success: function (response) {

                    // 4. Sonuçları Ekrana Bas
                    $('#loadingMessage').hide();

                    $('#bmiResult').text(response.bmiResult);
                    $('#adviceText').text(response.advice);

                    $('#workoutList').empty();
                    response.workoutPlan.forEach(function(item) {
                        $('#workoutList').append('<li class="list-group-item"><i class="fa-solid fa-check text-success me-2"></i>' + item + '</li>');
                    });

                    $('#resultContent').fadeIn();
                },
                error: function () {
                    $('#loadingMessage').hide();
                    alert("Bir hata oluştu. Lütfen değerleri kontrol ediniz.");
                }
            });
        }, 1500); // 1500ms bekleme
    }
</script>